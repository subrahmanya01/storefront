<div class="container">
    <h2>Discount Management</h2>

    <div class="form-container">
      <h3>{{ editingDiscount ? 'Edit Discount' : 'Add New Discount' }}</h3>
      <form [formGroup]="discountForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <div class="form-field">
            <label for="code">Code</label>
            <input id="code" type="text" formControlName="code" placeholder="Enter Discount Code">
            <div *ngIf="discountForm.get('code')?.invalid && discountForm.get('code')?.touched" class="error-message">
              Code is required.
            </div>
          </div>
          <div class="form-field">
            <label for="percentage">Percentage <span class="required">*</span></label>
            <input id="percentage" type="number" formControlName="percentage" placeholder="Enter Percentage">
            <div *ngIf="discountForm.get('percentage')?.invalid && discountForm.get('percentage')?.touched" class="error-message">
              Percentage is required and must be a number between 0 and 100.
            </div>
          </div>
          <div class="form-field">
            <label for="minOrderAmount">Min Order Amount</label>
            <input id="minOrderAmount" type="number" formControlName="minOrderAmount" placeholder="Enter Minimum Order Amount">
          </div>
          <div class="form-field">
            <label for="category">Category</label>
            <input id="category" type="text" formControlName="category" placeholder="Enter Category (Optional)">
          </div>
          <div class="form-field">
            <label for="productId">Product ID</label>
            <input id="productId" type="text" formControlName="productId" placeholder="Enter Product ID (Optional)">
          </div>
          <div class="form-field">
            <label for="validFrom">Valid From <span class="required">*</span></label>
            <input id="validFrom" type="date" formControlName="validFrom">
            <div *ngIf="discountForm.get('validFrom')?.invalid && discountForm.get('validFrom')?.touched" class="error-message">
              Valid From date is required.
            </div>
          </div>
          <div class="form-field">
            <label for="validTo">Valid To <span class="required">*</span></label>
            <input id="validTo" type="date" formControlName="validTo">
            <div *ngIf="discountForm.get('validTo')?.invalid && discountForm.get('validTo')?.touched" class="error-message">
              Valid To date is required.
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" [disabled]="discountForm.invalid" class="submit-button">
            {{ editingDiscount ? 'Update Discount' : 'Create Discount' }}
          </button>
          <button *ngIf="editingDiscount" type="button" (click)="cancelEdit()" class="cancel-button">
            Cancel
          </button>
        </div>
      </form>
    </div>

    <div class="table-container">
      <h3>Existing Discounts</h3>
      <div *ngIf="loading" class="loading-message">Loading...</div>
      <div *ngIf="error" class="error-message">Error: {{ error }}</div>

      <div *ngIf="discounts.length === 0 && !loading && !error" class="no-data-message">
        No discounts found.
      </div>

      <div *ngIf="discounts.length > 0" class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Code</th>
              <th>Percentage</th>
              <th>Min Order Amount</th>
              <th>Category</th>
              <th>Product ID</th>
              <th>Valid From</th>
              <th>Valid To</th>
              <th>Created At</th>
              <th>Modified At</th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let discount of discounts">
              <td>{{ discount.code }}</td>
              <td>{{ discount.percentage }}%</td>
              <td>{{ discount.minOrderAmount }}</td>
              <td>{{ discount.category }}</td>
              <td>{{ discount.productId }}</td>
              <td>{{ discount.validFrom | date:'shortDate' }}</td>
              <td>{{ discount.validTo | date:'shortDate' }}</td>
              <td>{{ discount.createdAt | date:'shortDate' }}</td>
              <td>{{ discount.modifiedAt | date:'shortDate' }}</td>
              <td class="action-buttons">
                <button (click)="editDiscount(discount)" class="edit-button">Edit</button>
              </td>
              <td class="action-buttons">
                <button (click)="deleteDiscount(discount.id)" class="delete-button">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>