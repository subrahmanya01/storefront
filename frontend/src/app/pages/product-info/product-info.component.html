<div class="container">
    <app-bread-scrum></app-bread-scrum>

    <div class="product-desc d-flex">
        <div class="product-image-view">
            <app-product-viewer [images]="getProductImages()"></app-product-viewer>
        </div>
        <div class="product-description">
            <div class="name">{{product.name}}</div>
            <div class="rating-and-availability">
                <app-rating [rating]="productRatingOutof5" [isReadOnly]="true" text="(2+ Reviews)"></app-rating> |
                @if(selectedVariant?.inventory?? 0 > 0)
                {
                <span class="availability" style="color: var(--button-1);">In stock</span>
                }
                @else
                {
                <span class="availability" style="color: var(--button-2);">Out of stock</span>
                }
            </div>
            <div class="price mt-2 mb-2">$ {{selectedVariant?.price}}</div>
            <div class="description mt-2">
                {{product.description}}
            </div>
            <div class="sep-bar mt-4 mb-2"></div>
            @for(attribute of product.allowedAttributes; track attribute)
            {
                @switch (attribute) {
                    @case ("Size") {
                        <div class="size-selector mt-4">
                            <app-size-selector [label]="attribute" 
                            (onSizeSelect)="onCombinationSelection($event, 'Size')"
                            [selectedSize]="currentAttributeSelection.get(attribute)??''"
                            [availableSizes]="getAttributeValues(attribute)">
                            
                            </app-size-selector>
                        </div>
                    }
                    @case ("Color") {
                        <div class="color-selection mt-4">
                            <app-color-selector (onColorSelected)="onCombinationSelection($event, 'Color')"
                            [selectedColor]="currentAttributeSelection.get(attribute)??[]"
                            [colors]="getAttributeValues(attribute)"
                            >

                            </app-color-selector>
                        </div>
                    }
                    @default {
                        <div class="size-selector mt-4">
                            <app-size-selector [label]="attribute" 
                            (onSizeSelect)="onCombinationSelection($event, attribute)" 
                            [selectedSize]="currentAttributeSelection.get(attribute)??''"
                            [availableSizes]="getAttributeValues(attribute)">
                        </app-size-selector>
                        </div>
                    }
                }
            }
           
            <div class="quantity-selection-and-order mt-4 d-flex justify-content-between">
                <app-quantity-selector style="margin-right: 10px;" (quantityChange)="onQuantityChange($event)"></app-quantity-selector>
                <app-button [size]="'small'" [label]="'Buy Now'" style="width: 100%;" (click)="addToCart()"></app-button>
                <div class="like" (click)="addToWatchList()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21.257 10.962C21.731 11.582 21.731 12.419 21.257 13.038C19.764 14.987 16.182 19 12 19C7.81801 19 4.23601 14.987 2.74301 13.038C2.51239 12.7411 2.38721 12.3759 2.38721 12C2.38721 11.6241 2.51239 11.2589 2.74301 10.962C4.23601 9.013 7.81801 5 12 5C16.182 5 19.764 9.013 21.257 10.962V10.962Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                     </svg>
                </div>
            </div>
            <div class="heighlight mt-4">
                <app-product-heighlight [isFreeDel]="isFreeDelevery"></app-product-heighlight>
            </div>
        </div>
    </div>

    @if(relatedProducts.length >0)
    {
        <div class="related-products">
            <app-legend [label]="'Related'"></app-legend>
        </div>
        <app-product-carousel [items]="relatedProducts" title="Related Products"></app-product-carousel>
    }

    <app-product-reviews-display [productId]="productId"></app-product-reviews-display>
</div>